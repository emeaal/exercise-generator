<mat-toolbar color="primary">
    <div style="display:flex; align-items:center; height:100%;">
      <span><a routerLink="/home">SwedishFromScratch</a></span>
      <a mat-button routerLink="/home" routerLinkActive="active-link" style="min-height:100%;">Home</a>
      <a mat-button routerLink="/xgen" routerLinkActive="active-link" style="min-height:100%;">Create lesson
          <span class="arrow-down"></span>
      </a>
      <a mat-button routerLink="/tablegen" routerLinkActive="active-link" style="min-height:100%;">Generate tables</a>
      <a mat-button routerLink="/gram-x" routerLinkActive="active-link" style="min-height:100%;">Grammar</a>
      <a mat-button routerLink="/url-create" routerLinkActive="active-link" style="min-height:100%;">URL</a>
    </div>

    <div style="float:right">
        <button mat-button [matMenuTriggerFor]="menu">{{ls.localize('language-selection-menu')}}</button>
        <mat-menu #menu="matMenu">
            <button mat-menu-item
                (click)="changeLanguage('english')">{{ls.localize('language-selection-english')}}</button>
            <button mat-menu-item
                (click)="changeLanguage('swedish')">{{ls.localize('language-selection-swedish')}}</button>
            <button mat-menu-item
                (click)="changeLanguage('russian')">{{ls.localize('language-selection-russian')}}</button>
            <!--<button mat-menu-item disabled="true">{{ls.localize('language-selection-ukrainian')}}</button>-->
        </mat-menu>
        <i class="material-icons">language</i>
    </div>

</mat-toolbar>

<div class="submenu" *ngIf="isXgenRoute">
    <div class="spacer2"></div>
    <a mat-button (click)="currentPageNumber = 0" [class.active-link]="currentPageNumber === 0">Start</a>
    <a mat-button (click)="currentPageNumber = 1" [class.active-link]="currentPageNumber === 1">Review</a>
    <a mat-button (click)="currentPageNumber = 2" [class.active-link]="currentPageNumber === 2">Exercise options</a>
    <a mat-button (click)="currentPageNumber = 3" [class.active-link]="currentPageNumber === 3">View lesson</a>
</div>

<br>

<app-waiter></app-waiter>

<div class="margin-container">
    <div *ngIf="currentPage=='add'">
        <h2>Create exercise</h2>

        <div *ngIf="currentPageNumber==0">
            <!--  <label id="example-radio-group-label">Choose your language</label>
                <mat-radio-group aria-labelledby="example-radio-group-label" class="example-radio-group"
                    [(ngModel)]="exerciseLanguage">
                    <mat-radio-button class="example-radio-button" *ngFor="let xlang of xlangs; let i = index"
                        [value]="xlang" [disabled]="i === 1">
                        {{xlang}}
                    </mat-radio-button>
                </mat-radio-group>
            </div>-->
            <div class="prepared-lesson-container">
                {{ ls.localize('menu-select-lesson') }}
                <br /><br />
                <mat-form-field>
                    <mat-select [(value)]="manualLesson">
                        <mat-option *ngFor="let lesson of validLessons" [value]="lesson.lessonNumber">
                            {{ lesson.lessonNumber }} - {{ lesson.title }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <br /><br />
                <button mat-button mat-raised-button color="primary" (click)="reviewManualExercise()">
                    Review
                </button>
            </div>
            <div style="float:left">
                Write your own text
                <br><br>
                <mat-form-field style="width: 30%;">
                    <input matInput type="number" [(ngModel)]="lessonNumber" placeholder="Lesson number" #ln
                        autocomplete="off">
                </mat-form-field>
                &nbsp;&nbsp;&nbsp;
                <mat-form-field style="width: 50%;">
                    <input matInput type="text" [(ngModel)]="lessonTitle" placeholder="Title" #title autocomplete="off">
                </mat-form-field>
                <br />
                <mat-form-field style="width: 90%;">
                    <textarea matInput [(ngModel)]="textareaValue" #newtext placeholder="Enter text here"
                        cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="5"
                        cdkAutosizeMaxRows="50">{{ textareaValue }}</textarea>
                </mat-form-field>
                <br /><br />
                <button mat-button mat-raised-button color="warn" (click)="clearForm()"
                    [disabled]="!(lessonNumber && lessonTitle && textareaValue)">Clear</button>
                &nbsp;&nbsp;&nbsp;
                <button mat-button mat-raised-button color="primary"
                    (click)="process(ln.value, title.value, newtext.value)">Process!</button>
            </div>
        </div>
        <div *ngIf="currentPageNumber==1">
            <h3>Check information</h3>
            <button mat-button mat-raised-button color="primary" (click)="back()">
                Back to text
            </button>
            &nbsp;&nbsp;&nbsp;
            <button mat-button mat-raised-button color="primary" (click)="next()">
                Next
            </button>
            &nbsp;&nbsp;&nbsp;
            <br />
            <app-waiter></app-waiter>
            <div class="help-right">
                <button *ngIf="!showValidPos" mat-button mat-raised-button (click)="togglePos()">Show available
                    POS</button>
                <button *ngIf="showValidPos" mat-button mat-raised-button (click)="togglePos()">Hide available
                    POS</button>
                <br /><br />
                <div *ngIf="showValidPos">
                    <div *ngFor="let vPos of validPos">
                        {{vPos}}
                    </div>
                </div>
            </div>
            <br />
            <table>
                <tr>
                    <th>Word</th>
                    <th>Lemma</th>
                    <th>POS</th>
                    <th>Alternative answers <mat-icon inline="true"
                            matTooltip="Enter an alternative answer or a list of comma-separated values. Leave blank to allow only the original answer.">help</mat-icon>
                    </th>
                    <!-- <th>Multiple choice distractors (3)<mat-icon inline="true"
                            matTooltip="Enter a comma-separated list of 3 distractors for multiple-choice questions.">help</mat-icon>
                    </th>-->
                    <th>Exclude from exercise <mat-icon inline="true"
                            matTooltip="Exclude this word from the automatic exercise generation.">help</mat-icon></th>
                    <th>Delete</th>
                    <th></th>
                </tr>
                <tr *ngFor="let obj of posData; let i = index" class="uip">
                    <td><mat-form-field><input matInput type="text" [value]="obj['text']" #text
                                (blur)="posData[i]['text'] = text.value"></mat-form-field></td>
                    <td><mat-form-field><input matInput type="text" [value]="obj['lemma']" #lemma
                                (blur)="posData[i]['lemma'] = lemma.value"></mat-form-field></td>
                    <td><mat-form-field><input matInput type="text" [value]="obj['pos']" #pos
                                (blur)="posData[i]['pos'] = pos.value"></mat-form-field></td>
                    <td><mat-form-field><input matInput type="text" [(ngModel)]="altAnswer[i]" #altAnswerInput
                                (blur)="posData[i]['altAnswer'] = altAnswerInput.value"></mat-form-field></td>
                    <td><mat-form-field><input matInput type="text" #distractors
                                (blur)="posData[i]['distractors'] = distractors.value"></mat-form-field></td>
                    <td><mat-checkbox #exclude (change)="posData[i]['exclude'] = exclude.checked"></mat-checkbox></td>
                    <td><mat-icon (click)="deleteWord(i)"
                            style="color: darkred; cursor: pointer;">delete_forever</mat-icon></td>
                    <td><button *ngIf="obj['pos']==='MAD'" mat-button mat-raised-button (click)="insertLinebreak(i)"
                            [disabled]="getIsDisabled(i)">Insert linebreak after this</button></td>
                </tr>
            </table>

            <br /><br />
            <button mat-button mat-raised-button color="primary" (click)="back()">
                Back
            </button>
            &nbsp;&nbsp;&nbsp;
            <button mat-button mat-raised-button color="primary" (click)="next()">
                Next
            </button>
            &nbsp;&nbsp;&nbsp;
            <!--<button mat-button mat-raised-button color="warn" (click)="discard()">
            Discard
        </button>
        &nbsp;&nbsp;&nbsp;
        <button mat-button mat-raised-button color="warn" (click)="debug()">Debug</button>  -->
        </div>
        <div *ngIf="currentPageNumber==2">

            <h3>Exercise options</h3>

            <br />
            Generate exercises for the following POS:
            <br />
            <div *ngFor="let vPos of validPos">
                <mat-checkbox [(ngModel)]="isChecked[vPos]" [value]="vPos">{{vPos}}</mat-checkbox>
                <br />
            </div>

            <br />
            <mat-checkbox [(ngModel)]="excludeFirstSentence">Exclude first sentence from exercise
                generation</mat-checkbox>
            <br />
            <mat-checkbox [(ngModel)]="excludeLastSentence">Exclude last sentence from exercise
                generation</mat-checkbox>
            <br />

            <br />

            <br />
            Include only every
            <mat-form-field>
                <mat-select [(ngModel)]="selectedEveryX" everyx>
                    <mat-option value="2">2nd</mat-option>
                    <mat-option value="3">3rd</mat-option>
                    <mat-option value="4">4th</mat-option>
                    <mat-option value="5">5th</mat-option>
                </mat-select>
            </mat-form-field>
            word for exercise generation
            <br />
            <button mat-button mat-raised-button color="primary" (click)="back()">Back</button>
            &nbsp;&nbsp;&nbsp;
            <button mat-button mat-raised-button color="primary" (click)="preview()">Preview exercise</button>
            &nbsp;&nbsp;&nbsp;
            <!-- <button mat-button mat-raised-button color="warn" (click)="discard()">
            Discard
        </button> -->
        </div>
        <div *ngIf="currentPageNumber==3">
            <h2>{{lessonNumber }} {{ lessonTitle }} </h2>
          
            <div>
                <ng-container *ngFor="let word of posData; let i = index">
                  <ng-container *ngFor="let vPos of validPos">
                    <ng-container *ngIf="vPos === word.pos">
                      <ng-container *ngIf="isChecked[vPos]">
                        <ng-container *ngIf="shouldRenderInputBox(i)">
                          <input type="text" class="gap" [(ngModel)]="userInput[i]"
                            [ngClass]="{'correct': isAnswerChecked[i], 'wrong': !isAnswerChecked[i], 'white-gap': !AreAnswersChecked}"
                            [id]="'gap-' + i">&nbsp;
                        </ng-container>
                        <ng-container *ngIf="!shouldRenderInputBox(i)">
                          <span [innerHtml]="word.text" style="margin-right: 3px;"></span>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="!isChecked[vPos]">
                        <span [innerHtml]="word.text" style="margin-right: 3px;"></span>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </div>
              
          
            <div *ngIf="totalCount>1">
              <h2>You got: {{correctCount}}/{{totalCount}}!</h2>
            </div>
          


            <br>
            <button mat-button mat-raised-button color="primary" (click)="back()">Back</button>
            &nbsp;&nbsp;&nbsp;
            <button mat-button mat-raised-button (click)="checkAnswers(); AreAnswersChecked = true;"
                color="primary">{{ls.localize('exercise-check-answers')}}</button>
            &nbsp;&nbsp;&nbsp;
            <button mat-button mat-raised-button (click)="showAnswers()"
                color="accent">{{ls.localize('exercise-show-answers')}}</button>
        </div>

        <!--<div *ngIf="currentPage=='view'">
    <h2>View all texts</h2>
</div>

<div *ngIf="currentPage=='options'">
    <h2>Options</h2>
    <br/><br/>
    Nothing to see here.
</div> -->
    </div>
</div>